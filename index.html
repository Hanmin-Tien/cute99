<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<title>å¯æ„›ä¹ä¹ä¹˜æ³•éŠæˆ²</title>

<style>
body {
  margin: 0;
  font-family: "Comic Sans MS", "Noto Sans TC", sans-serif;
  background: linear-gradient(#ffe6f2, #fff);
  text-align: center;
}

h1 {
  color: #ff69b4;
}

#game {
  max-width: 420px;
  margin: auto;
  padding: 10px;
}

#fall-area {
  height: 120px;
  font-size: 48px;
  color: #ff4081;
}

#number {
  animation: fall 2s linear;
}

@keyframes fall {
  from { transform: translateY(-80px); }
  to { transform: translateY(60px); }
}

#choices {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}

.choice {
  padding: 12px;
  font-size: 18px;
  border-radius: 20px;
  border: none;
  background: #ffb6c1;
}

#character img {
  width: 120px;
  margin-top: 10px;
}

@keyframes jump {
  0% { transform: translateY(0); }
  50% { transform: translateY(-30px) rotate(10deg); }
  100% { transform: translateY(0); }
}
</style>
</head>

<body>

<h1>ğŸ€ ä¹ä¹ä¹˜æ³•å°éŠæˆ² ğŸ€</h1>

<div id="game">

  åˆ†æ•¸ï¼š<span id="score">300</span>ã€€
  â° æ™‚é–“ï¼š<span id="time">60</span>

  <br><br>

  é›£åº¦ï¼š
  <select id="level">
    <option value="5">ç°¡å–®</option>
    <option value="9" selected>æ™®é€š</option>
    <option value="12">å›°é›£</option>
  </select>

  <div id="fall-area"></div>

  <div id="choices"></div>

  <p id="message"></p>

  <div id="character">
    <img src="girl.png" alt="å°å¥³å­©è§’è‰²">
  </div>

</div>

<!-- éŸ³æ•ˆ -->
<audio id="correct" src="correct.mp3"></audio>
<audio id="wrong" src="wrong.mp3"></audio>
<audio id="win" src="win.mp3"></audio>

<script>
/* ===============================
   éŠæˆ²ç‹€æ…‹
================================ */
let score = 300;
let time = 60;
let correctAnswer = "";
let gameOver = false;
let timer;

/* ===============================
   åˆå§‹åŒ–
================================ */
function initGame() {
  score = 300;
  time = 60;
  gameOver = false;

  scoreEl.textContent = score;
  timeEl.textContent = time;
  message.textContent = "";

  clearInterval(timer);
  startTimer();
  randomQuestion();
}

/* ===============================
   DOM å¿«å–
================================ */
const scoreEl = document.getElementById("score");
const timeEl = document.getElementById("time");
const levelEl = document.getElementById("level");
const fallArea = document.getElementById("fall-area");
const choices = document.getElementById("choices");
const message = document.getElementById("message");
const girl = document.querySelector("#character img");

/* ===============================
   éŸ³æ•ˆ
================================ */
const soundCorrect = document.getElementById("correct");
const soundWrong = document.getElementById("wrong");
const soundWin = document.getElementById("win");

/* ===============================
   è¨ˆæ™‚
================================ */
function startTimer() {
  timer = setInterval(() => {
    if (gameOver) return;

    time--;
    timeEl.textContent = time;

    if (time <= 0) endGame("æ™‚é–“åˆ° â°");
  }, 1000);
}

/* ===============================
   å‡ºé¡Œ
================================ */
function randomQuestion() {
  if (gameOver) return;

  fallArea.innerHTML = "";
  choices.innerHTML = "";

  const max = Number(levelEl.value);
  const a = Math.floor(Math.random() * max) + 1;
  const b = Math.floor(Math.random() * max) + 1;

  correctAnswer = `${a} Ã— ${b}`;

  const num = document.createElement("div");
  num.id = "number";
  num.textContent = a * b;
  fallArea.appendChild(num);

  const answerSet = new Set([correctAnswer]);
  while (answerSet.size < 4) {
    const x = Math.floor(Math.random() * max) + 1;
    const y = Math.floor(Math.random() * max) + 1;
    answerSet.add(`${x} Ã— ${y}`);
  }

  [...answerSet].sort(() => Math.random() - 0.5).forEach(ans => {
    const btn = document.createElement("button");
    btn.className = "choice";
    btn.textContent = ans;
    btn.onclick = () => checkAnswer(ans);
    choices.appendChild(btn);
  });
}

/* ===============================
   æª¢æŸ¥ç­”æ¡ˆ
================================ */
function checkAnswer(ans) {
  if (gameOver) return;

  if (ans === correctAnswer) {
    score += 100;
    soundCorrect.play();
  } else {
    score -= 100;
    soundWrong.play();
  }

  scoreEl.textContent = score;

  if (score <= 0) endGame("å¤±æ•—äº† ğŸ˜­");
  else if (score >= 1300) {
    soundWin.play();
    girlCelebrate();
    endGame("ğŸ‰ é€šé—œæˆåŠŸï¼");
  } else randomQuestion();
}

/* ===============================
   çµæŸ
================================ */
function endGame(text) {
  gameOver = true;
  clearInterval(timer);

  message.textContent = text;
  choices.innerHTML = `
    <button class="choice" onclick="initGame()">ğŸ”„ é‡æ–°é–‹å§‹</button>
  `;
}

/* ===============================
   å°å¥³å­©å‹•ç•«
================================ */
function girlCelebrate() {
  girl.style.animation = "jump 0.8s";
  setTimeout(() => girl.style.animation = "", 800);
}

/* ===============================
   é›£åº¦å³æ™‚ç”Ÿæ•ˆ
================================ */
levelEl.addEventListener("change", randomQuestion);

/* ===============================
   å•Ÿå‹•
================================ */
initGame();
</script>

</body>
</html>
